(()=>{var e=io(),n="",t="",o=!1,i="",r=document.getElementById("room-form"),s=document.getElementById("message-form"),l=document.querySelector("#chatbox"),a=document.getElementById("leave"),d=document.getElementById("list"),c=function(e,t){if(e===n&&t){var r=document.getElementById(t).querySelector(".msg");e===n&&r&&(o=!0,i=t,s.send.innerText="Edit",s.inputmessage.value=r.innerText,s.delete.style.display="block")}},u=function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(t){var r=document.createElement("div");r.id=o,r.addEventListener("dblclick",(function(){return c(e,o)})),(e===n||i)&&r.classList.add("self");var s='<span class="author">'.concat(e,'</span>\n    <span class="msg">').concat(t.toString(),"</span>");r.innerHTML=s,l.appendChild(r),l.scrollTop=l.scrollHeight}},m=function(){var r=s.inputmessage.value.trim();if(s.inputmessage.value="",""!==r)return n&&t?o&&i?(e.emit("newEditMessage",{username:n,room:t,text:r,id:i},(function(e){if(e&&e.error)return console.log(e.error)})),i="",o=!1,s.delete.style.display="none",s.send.innerText="Send"):void e.emit("newMessage",{username:n,room:t,text:r},(function(e){if(e&&e.error)return console.log(e.error)})):u("star444",r,"abc123",!0)};e.on("message",(function(e){var n=e.user,t=e.text,o=e.id;u(n,t,o)})),e.on("editMessage",(function(e){!function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"no_id_given",o=document.getElementById(t);if(o){o.querySelector(".msg").innerText=n,l.scrollTop=l.scrollHeight}}(e.user,e.text,e.id)})),e.on("deleteMessage",(function(e){!function(e){var n=document.getElementById(e);n&&(n.remove(),l.scrollTop=l.scrollHeight)}(e.id)})),e.on("pInfo",(function(e){!function(e){document.getElementById("total-p").innerText=e.length;var n=document.getElementById("p-list-inner"),t=document.createElement("ul");e.forEach((function(e){var n=document.createElement("li");n.innerText=e,t.appendChild(n)})),n.innerHTML=t.innerHTML}(e.users)})),r.addEventListener("submit",(function(o){if(o.preventDefault(),""!==t)return window.location.hash="chat";var i=r.name.value.trim(),s=r.room.value.trim();e.emit("join",{name:i,room:s},(function(e){if(e.error)return console.log(e.error);var o;"joined"===e.status&&(a.style.display="block",d.classList.add("active"),document.getElementById("p-list").classList.add("active"),o=e.user,n=o.name,t=o.room,document.getElementById("room-title").innerText="Room ~ ".concat(t),window.location.hash="chat",l.innerHTML="")}))})),s.addEventListener("submit",(function(e){e.preventDefault(),m()})),s.inputmessage.addEventListener("keypress",(function(e){"Enter"===e.key&&!1===e.shiftKey&&(e.preventDefault(),m())})),s.delete.addEventListener("click",(function(n){n.preventDefault(),e.emit("sendDelete",{id:i,room:t},(function(e){return e&&e.error?console.log(e.error):(i="",o=!1,s.delete.style.display="none",s.inputmessage.value="",s.send.innerText="Send")}))})),a.addEventListener("click",(function(){window.location="/"})),d.addEventListener("click",(function(){document.getElementById("p-list").classList.toggle("visible")}))})();